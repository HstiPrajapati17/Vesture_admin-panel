<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Admin Checkout — Clothing Manufacturing</title>

	<!-- Bootstrap (used by markup classes) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/Sidebar.css">
	<link rel="stylesheet" href="/css/purchase-order.css">
</head>

<body>

	<!-- Sidebar container -->
	<div id="sidebar-container"></div>

	<!-- Navbar container -->
	<div id="navbar-container"></div>

	<main class="main-content" id="main-content">
		<div class="container-fluid">
			<div class="h_checkout-shell">
				<div class="h_checkout-top">
					<div class="brand-pill">
						<div class="brand-title">Checkout</div>
					</div>
				</div>
				<div class="row g-4">
					<div class="col-lg-8">
						<div class="card card-modern">
							<div class="card-body h_custom_card_padding">
								<h5 class="mb-4 text-decoration-underline h_checkout_main_title">Customer
									& Shipping</h5>
								<form id="checkout-form">
									<div class="row g-3">
										<div class="col-md-6">
											<label class="form-label">Customer Name</label>
											<input type="text" id="cust-name" class="form-control"
												placeholder="John Doe" required>
										</div>
										<div class="col-md-6">
											<label class="form-label">Email</label>
											<input type="email" id="cust-email" class="form-control"
												placeholder="john@example.com" required>
										</div>

										<div class="col-md-4">
											<label class="form-label">Phone</label>
											<input type="tel" id="cust-phone" class="form-control"
												placeholder="+1 555 555 5555" required>
										</div>
										<div class="col-md-8">
											<label class="form-label">Company / Factory</label>
											<input type="text" id="cust-company" class="form-control"
												placeholder="ABC Textiles Pvt Ltd">
										</div>

										<div class="col-12">
											<label class="form-label">Shipping Address</label>
											<input type="text" id="ship-address" class="form-control"
												placeholder="Street, Building, Area" required>
										</div>

										<div class="col-md-4">
											<label class="form-label">City</label>
											<input class="form-control" id="ship-city" placeholder="Toronto" required>
										</div>
										<div class="col-md-4">
											<label class="form-label">Province / State</label>
											<input class="form-control" id="ship-state" placeholder="Ontario" required>
										</div>
										<div class="col-md-4">
											<label class="form-label">Postal / ZIP</label>
											<input class="form-control" id="ship-zip" placeholder="M1A1A1" required>
										</div>

										<div class="col-12 mt-2">
											<hr>
										</div>

										<div class="col-12">
											<h6 class="mb-2">Payment Method</h6>
											<div class="payment-chips mb-3" role="tablist">
												<div class="chip active" data-pay="card" id="chip-card"><i
														class="bi bi-credit-card me-1"></i> Card</div>
												<div class="chip" data-pay="cod" id="chip-cod"><i
														class="bi bi-cash-stack me-1"></i> COD</div>
											</div>

											<div id="payment-forms">
												<div class="payment-panel" data-method="card">
													<div class="row g-2">
														<div class="col-md-6">
															<label class="form-label">Cardholder</label>
															<input class="form-control" placeholder="John Doe">
														</div>
														<div class="col-md-6">
															<label class="form-label">Card Number</label>
															<input class="form-control" type="text" inputmode="numeric"
																pattern="[0-9]*" maxlength="16"
																placeholder="4242 4242 4242 4242">
														</div>
														<div class="col-md-4">
															<label class="form-label">Expiry</label>
															<input class="form-control" placeholder="MM/YY" type="date">
														</div>
														<div class="col-md-4">
															<label class="form-label">CVV</label>
															<input class="form-control" placeholder="123" type="number">
														</div>
														<div class="col-md-4">
															<label class="form-label">Billing Name</label>
															<input class="form-control"
																placeholder="Billing name if different">
														</div>
													</div>
												</div>

												<div class="payment-panel d-none" data-method="cod">
													<div class="p-3 border rounded-2">
														<p class="muted-small mb-2">Cash on delivery — collect payment
															at delivery. Mark order as COD in records.</p>

														<!-- Custom COD agreement checkbox -->
														<div class="form-check custom-checkbox">
															<input class="form-check-input" type="checkbox"
																id="cod-agree">
															<label class="form-check-label" for="cod-agree">
																I agree to pay in cash upon delivery
															</label>
														</div>
													</div>
												</div>

											</div>
										</div>

										<div class="col-12 text-end mt-3">
											<button type="submit" class="btn btn-brand">Place Order</button>
										</div>

									</div>
								</form>
							</div>
						</div>

						<div class="card card-modern mt-3">
							<div class="card-body h_custom_card_padding">
								<h5 class="mb-2 text-decoration-underline mb-3 h_checkout_main_title">Shipping Methods
								</h5>

								<!-- Checkboxes kept for look but JS makes them mutually exclusive -->
								<div class="form-check mb-2 custom-checkbox">
									<label class="d-flex align-items-center gap-2">
										<input class="form-check-input shipping-checkbox" type="checkbox"
											name="shipping-method" id="standard-shipping" value="standard" checked>
										<span class="form-check-label">Standard Shipping — 5 to 7 business days
											($10)</span>
									</label>
								</div>
								<div class="form-check mb-2 custom-checkbox">
									<label class="d-flex align-items-center gap-2">
										<input class="form-check-input shipping-checkbox" type="checkbox"
											name="shipping-method" id="express-shipping" value="express">
										<span class="form-check-label">Express Shipping — 2 to 3 business days
											(+$25)</span>
									</label>
								</div>
								<div class="form-check mb-2 custom-checkbox">
									<label class="d-flex align-items-center gap-2">
										<input class="form-check-input shipping-checkbox" type="checkbox"
											name="shipping-method" id="overnight-shipping" value="overnight">
										<span class="form-check-label">Overnight Shipping — 1 business day (+$50)</span>
									</label>
								</div>
							</div>
						</div>

					</div>

					<div class="col-lg-4">
						<div class="card card-modern p-3">
							<div class="card-body  h_custom_card_padding p-0">
								<h5 class="mb-3 text-decoration-underline h_checkout_main_title">Order Summary</h5>

								<div id="order-items" class="mb-2"></div>

								<div class="summary-card mt-3">
									<div class="summary-row">
										<div class="muted-small">Subtotal</div>
										<div id="subtotal-amount">$0.00</div>
									</div>
									<div class="summary-row">
										<div class="muted-small">Shipping</div>
										<div id="shipping-amount">$0.00</div>
									</div>
									<div class="summary-row">
										<div class="muted-small">Taxes</div>
										<div id="taxes-amount">$0.00</div>
									</div>
									<hr>
									<div class="summary-row">
										<div class="fw-bold">Total</div>
										<div class="total-amount" id="grand-total">$0.00</div>
									</div>
									<div class="d-grid gap-2 mt-3">
										<button id="mark-paid" class="btn btn-brand btn-sm">Proceed to Payment</button>
										<!-- <button id="print-invoice" class="btn btn-ghost btn-sm"><i
												class="bi bi-printer"></i> Print Invoice</button> -->
									</div>
								</div>
							</div>
						</div>

						<div class="card card-modern p-3 mt-3">
							<div class="card-body h_custom_card_padding p-0">
								<h6 class="mb-2">Quick Actions</h6>
								<div class="d-grid gap-2">
									<button class="btn btn-ghost">Create Shipping Label</button>
									<button class="btn btn-ghost h_cancel-btn" id="cancel-order">Cancel Order</button>
									<button class="btn btn-ghost">Add to Production</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Template -->
		<template id="order-item-template">
			<div class="order-item flex-wrap">
				<img src="" alt="product">
				<div class="flex-grow-1">
					<div class="d-flex justify-content-between align-items-start flex-wrap">
						<div>
							<div class="fw-semibold product-title">Product name</div>
							<div class="meta product-meta">SKU: - · Color: -</div>
							<div class="mt-1 muted-small d-flex align-items-center gap-2">Qty:
								<input type="number" class="form-control form-control-sm qty-input px-1 py-0 rounded"
									style="width: 46px;" value="1" min="1">
							</div>
						</div>
						<div class="text-end h_order-item_end-intro">
							<div class="fw-semibold item-line-price mb-2">$0.00</div>
							<button class="btn btn-ghost btn-sm btn-delete"><i class="bi bi-trash"></i></button>
						</div>
					</div>
				</div>
			</div>
		</template>
	</main>

	<!-- Overlay for mobile -->
	<div class="overlay"></div>

	<!-- Bootstrap JS bundle -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sidebar-loader.js"></script>
	<script src="/js/navbar-loader.js"></script>

	<script>
		const initialItems = [
			{ id: 1, name: 'Premium Cotton T-Shirt', sku: 'TSH-001', color: 'Grey', price: 12.5, qty: 2, img: 'https://hamercop.com/cdn/shop/files/31-1988_800x.jpg?v=1750841171' },
			{ id: 3, name: 'Denim work jacket', sku: 'JKT-003', color: 'Blue', price: 120.0, qty: 1, img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTI0YFoBO0SnTeSGKWaBr2-wE4yvUs7jfGIoQ&s' }
		];

		const orderItemsContainer = document.getElementById('order-items');
		const subtotalEl = document.getElementById('subtotal-amount');
		const shippingEl = document.getElementById('shipping-amount');
		const taxesEl = document.getElementById('taxes-amount');
		const grandTotalEl = document.getElementById('grand-total');

		const shippingMethods = {
			standard: 10,
			express: 25,
			overnight: 50
		};

		function renderOrderItems() {
			orderItemsContainer.innerHTML = '';
			initialItems.forEach(item => {
				const template = document.getElementById('order-item-template');
				const clone = template.content.cloneNode(true);
				clone.querySelector('img').src = item.img;
				clone.querySelector('.product-title').textContent = item.name;
				clone.querySelector('.product-meta').textContent = `SKU: ${item.sku} · Color: ${item.color}`;
				const qtyInput = clone.querySelector('.qty-input');
				const linePriceEl = clone.querySelector('.item-line-price');
				linePriceEl.textContent = `$${(item.price * item.qty).toFixed(2)}`;
				qtyInput.value = item.qty;

				qtyInput.addEventListener('change', e => {
					item.qty = Math.max(1, parseInt(e.target.value) || 1);
					linePriceEl.textContent = `$${(item.price * item.qty).toFixed(2)}`;
					calcTotals();
				});

				clone.querySelector('.btn-delete').addEventListener('click', () => {
					const index = initialItems.findIndex(i => i.id === item.id);
					if (index > -1) initialItems.splice(index, 1);
					renderOrderItems();
					calcTotals();
				});

				orderItemsContainer.appendChild(clone);
			});
		}

		function calcTotals() {
			let subtotal = initialItems.reduce((acc, i) => acc + i.price * i.qty, 0);

			// find the checked shipping checkbox (JS enforces only one can be checked)
			const selected = document.querySelector('.shipping-checkbox:checked');
			let shippingType = selected ? selected.value : 'standard';
			let shippingCost = shippingMethods[shippingType] || 0;
			let taxes = subtotal * 0.13; // 13% tax for Canada
			let total = subtotal + shippingCost + taxes;

			subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
			shippingEl.textContent = `$${shippingCost.toFixed(2)}`;
			taxesEl.textContent = `$${taxes.toFixed(2)}`;
			grandTotalEl.textContent = `$${total.toFixed(2)}`;
		}

		// Form submission
		document.getElementById('checkout-form').addEventListener('submit', e => {
			e.preventDefault();

			const activeMethod = document.querySelector('.chip.active').dataset.pay;

			if (activeMethod === 'cod') {
				const codAgree = document.getElementById('cod-agree');
				if (!codAgree.checked) {
					alert('Please agree to pay in cash upon delivery before placing the order.');
					return;
				}
			}

			alert('Order submitted successfully!');
		});

		// Make the checkboxes behave like mutually-exclusive options (only one checked)
		document.querySelectorAll('.shipping-checkbox').forEach(cb => {
			cb.addEventListener('change', (e) => {
				const target = e.target;
				if (target.checked) {
					// uncheck others
					document.querySelectorAll('.shipping-checkbox').forEach(other => {
						if (other !== target) other.checked = false;
					});
				} else {
					// Prevent all from being unchecked: re-check this one if none are checked
					const anyChecked = Array.from(document.querySelectorAll('.shipping-checkbox')).some(c => c.checked);
					if (!anyChecked) {
						target.checked = true;
					}
				}
				calcTotals();
			});
		});

		// Payment chips logic
		document.querySelectorAll('.chip').forEach(chip => {
			chip.addEventListener('click', () => {
				document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
				chip.classList.add('active');
				const method = chip.dataset.pay;
				document.querySelectorAll('.payment-panel').forEach(p => {
					p.classList.toggle('d-none', p.dataset.method !== method);
				});
			});
		});

		// Cancel order button
		document.getElementById('cancel-order').addEventListener('click', () => {
			if (confirm('Are you sure you want to cancel this order?')) {
				initialItems.length = 0;
				renderOrderItems();
				calcTotals();
				alert('Order cancelled.');
			}
		});

		// Form submission
		document.getElementById('checkout-form').addEventListener('submit', e => {
			e.preventDefault();
			alert('Order submitted successfully!');
		});

		// Print invoice
		document.getElementById('print-invoice').addEventListener('click', () => {
			window.print();
		});

		// Initial render
		renderOrderItems();
		calcTotals();
	</script>
</body>

</html>