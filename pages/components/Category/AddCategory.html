<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>ClothMan Admin — Add / Edit Category</title>

	<!-- Bootstrap (used by markup classes) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/Sidebar.css">
	<link rel="stylesheet" href="/css/category.css">

</head>

<body>
	<!-- Sidebar container -->
	<div id="sidebar-container"></div>

	<!-- Navbar container -->
	<div id="navbar-container"></div>

	<main class="main-content" id="main-content">
		<div class="h_container-app">
			<div class="h_sheet" role="main" aria-labelledby="pageTitle">
				<header class="h_sheet-header">
					<div class="h_title" id="pageTitle"><i class="bi bi-plus-circle"></i>
						<span id="pageMode">Add
							Category</span>
					</div>
				</header>

				<div class="h_sheet-body">
					<!-- Left: Upload + quick settings -->
					<aside class="h_col-left">
						<h6 class="mb-2">Category Photo</h6>

						<label class="h_upload-area" id="uploadZone" for="categoryImage">
							<i class="bi bi-cloud-arrow-up-fill fs-3 d-block mb-2" style="color:var(--primary)"></i>
							<strong>Drag & drop</strong> or <u>click to browse</u>
							<div class="h_upload-hint mt-2">Maximum file size: 5MB • PNG, JPG, JPEG</div>
							<input id="categoryImage" type="file" accept="image/png,image/jpeg" multiple>
							<img id="singlePreview" class="h_preview" alt="Preview" style="display:none">
							<div id="previewGrid" class="h_preview-grid" aria-live="polite"></div>
						</label>

						<div style="height:1px;background:var(--soft);margin:16px 0"></div>

						<h6 class="h_section-label">Quick Settings</h6>
						<div class="form-check form-switch h_form-switch mb-2">
							<input class="form-check-input" type="checkbox" id="isVisible" checked>
							<label class="form-check-label ms-2" for="isVisible">Visible on store</label>
						</div>

						<!-- Status toggle: Active / Inactive -->
						<div class="mt-3 mb-3">
							<label class="h_field-label">Status</label>
							<div class="d-flex align-items-center gap-4">
								<label class="h_radio">
									<input type="radio" name="statusRadio" id="statusActive" value="active" checked>
									Active
								</label>
								<label class="h_radio">
									<input type="radio" name="statusRadio" id="statusInactive" value="inactive">
									Inactive
								</label>
							</div>
						</div>
					</aside>

					<!-- Right: Form -->
					<section class="h_col-right">
						<form id="categoryForm" class="needs-validation" novalidate>
							<div class="mb-3">
								<h6 class="h_section-label">Category Information</h6>

								<label class="h_field-label" for="title">Category Title</label>
								<input id="title" type="text" class="h_dark-input" placeholder="Enter Category Title"
									required>
								<div class="invalid-feedback">Please enter a category title.</div>
							</div>
							<label class="h_field-label" for="code">Category Code</label>
							<input id="code" type="text" class="h_dark-input mb-3" placeholder="E.g. CAT-MEN-001"
								required>
							<div class="invalid-feedback">Please enter a unique category code.</div>

							<div class="mb-3">
								<label class="h_field-label" for="description">Description</label>
								<textarea id="description" class="h_dark-textarea"
									placeholder="Category description"></textarea>
							</div>

							<div class="d-flex justify-content-end gap-2 mt-3">
								<button type="button" class="btn h_btn-outline-primary" id="cancelBtn"><i
										class="bi bi-x-circle me-1"></i>Cancel</button>
								<button type="submit" class="btn h_btn-primary" id="saveBtn"><i
										class="bi bi-check2-circle me-1"></i><span id="saveText">Add
										Category</span></button>
							</div>
						</form>
					</section>
				</div>
			</div>
		</div>
	</main>

	<!-- Overlay for mobile -->
	<div class="overlay"></div>

	<!-- Bootstrap JS bundle -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sidebar-loader.js"></script>
	<script src="/js/navbar-loader.js"></script>

	<script>
		// Header mode toggle based on ?mode=edit
		(function () {
			const params = new URLSearchParams(window.location.search || '');
			const isEdit = params.get('mode') === 'edit';
			document.getElementById('pageMode').textContent = isEdit ? 'Edit Category' : 'Add Category';
			document.getElementById('crumbMode').textContent = isEdit ? 'Edit' : 'Add';
			document.getElementById('saveText').textContent = isEdit ? 'Save Changes' : 'Add Category';
			// if edit and you want to pre-populate values, fetch here or read from query params
		})();

		// Upload area behavior: supports multiple files + preview thumbnails
		(function () {
			const zone = document.getElementById('uploadZone');
			const input = document.getElementById('categoryImage');
			const grid = document.getElementById('previewGrid');
			const singlePreview = document.getElementById('singlePreview');

			zone.addEventListener('click', () => input.click());
			zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
			zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
			zone.addEventListener('drop', e => {
				e.preventDefault(); zone.classList.remove('dragover');
				const files = Array.from(e.dataTransfer.files || []);
				// append to input.files if possible (not supported in all browsers)
				try { input.files = e.dataTransfer.files; } catch (_) { }
				renderFiles(files.length ? files : Array.from(input.files || []));
			});

			input.addEventListener('change', () => {
				renderFiles(Array.from(input.files || []));
			});

			function renderFiles(files) {
				grid.innerHTML = '';
				singlePreview.style.display = 'none';
				if (!files.length) return;
				// If only one image -> show large single preview, otherwise show grid of thumbs
				if (files.length === 1) {
					const file = files[0];
					if (!file.type.startsWith('image/')) return;
					const url = URL.createObjectURL(file);
					singlePreview.src = url; singlePreview.style.display = 'block';
					singlePreview.onload = () => URL.revokeObjectURL(url);
				} else {
					files.forEach(f => {
						if (!f.type.startsWith('image/')) return;
						const url = URL.createObjectURL(f);
						const wrap = document.createElement('div'); wrap.className = 'h_thumb';
						const img = document.createElement('img'); img.alt = f.name; img.src = url;
						img.onload = () => URL.revokeObjectURL(url);
						wrap.appendChild(img); grid.appendChild(wrap);
					});
				}
			}
		})();

		// SEO preview update (title + description)
		(function () {
			const title = document.getElementById('title');
			const desc = document.getElementById('description');
			const seoTitle = document.getElementById('seoTitle');
			const seoDesc = document.getElementById('seoDesc');

			function update() {
				seoTitle.textContent = title.value ? title.value + ' - ClothMan' : 'Category Title - ClothMan';
				seoDesc.textContent = desc.value ? desc.value.slice(0, 160) : 'Short description preview...';
			}
			title.addEventListener('input', update);
			desc.addEventListener('input', update);
		})();

		// Cancel button — go back
		document.getElementById('cancelBtn').addEventListener('click', () => history.back());

		// slugify helper
		function slugify(v) {
			return String(v || '').toLowerCase()
				.trim()
				.replace(/[^\w\s-]/g, '')
				.replace(/\s+/g, '-')
				.replace(/--+/g, '-');
		}

		// Validation (Bootstrap style) and submit handling
		(function () {
			const form = document.getElementById('categoryForm');
			form.addEventListener('submit', function (event) {
				// ensure code exists
				const codeEl = document.getElementById('code');
				if (!codeEl.value.trim()) {
					codeEl.classList.add('is-invalid');
				} else {
					codeEl.classList.remove('is-invalid');
				}

				// if slug empty -> auto-generate from title
				const slugEl = document.getElementById('slug');
				const titleEl = document.getElementById('title');
				if (!slugEl.value.trim()) {
					slugEl.value = slugify(titleEl.value);
				}

				if (!form.checkValidity() || !codeEl.value.trim()) {
					event.preventDefault(); event.stopPropagation();
					form.classList.add('was-validated');
					return;
				}

				event.preventDefault(); // demo behavior: prevent actual submit

				// Collect status radio value
				const status = document.querySelector('input[name="statusRadio"]:checked')?.value || 'active';

				// Gather data payload
				const payload = {
					title: titleEl.value.trim(),
					code: codeEl.value.trim(),
					slug: slugEl.value.trim(),
					description: document.getElementById('description').value.trim(),
					visible: document.getElementById('isVisible').checked,
					status: status
				};

				// TODO: Replace with fetch() to your API endpoint
				console.log('Category payload', payload);
				alert('Category saved (demo). Check console for payload.');

				form.classList.add('was-validated');
			}, false);
		})();
	</script>
</body>

</html>