<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Order Dashboard</title>

	<!-- Bootstrap (only for layout, not modal) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/Sidebar.css">
	<link rel="stylesheet" href="/css/sales.css">

</head>

<body>
	<!-- Sidebar -->
	<div id="sidebar-container"></div>

	<!-- Navbar -->
	<div id="navbar-container"></div>

	<main class="main-content custome-height-main-content" id="main-content">
		<div class="container-fluid p-4">

			<!-- Orders Table -->
			<div class="h_order-list mt-4">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h4>All Orders</h4>
				</div>

				<div class="table-responsive">
					<table class="table h_custom-sales-table align-middle text-center" id="orderTable">
						<thead class="table-dark">
							<tr>
								<th>#</th>
								<th>Customer</th>
								<th>Order ID</th>
								<th>Status</th>
								<th>Total (CAD)</th>
								<th>Date</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody id="tableBody">
							<!-- Filled by JS -->
						</tbody>
					</table>
				</div>

				<!-- Pagination -->
				<nav class="d-flex justify-content-center align-items-center mt-3 gap-3">
					<button class="btn btn-sm h_order-list-filter-btn" id="prevBtn">Prev</button>
					<span id="pageInfo" class="fw-bold" style="color: #604652;">1/1</span>
					<button class="btn btn-sm h_order-list-filter-btn" id="nextBtn">Next</button>
				</nav>
			</div>
		</div>
	</main>

	<!-- Custom Order Details Modal -->
	<div class="custom-modal-overlay" id="orderModal">
		<div class="custom-modal">
			<div class="custom-modal-header">Order Details</div>
			<div class="custom-modal-body" id="modalContent"></div>
			<div class="custom-modal-footer">
				<button class="custome_modal_btn h_cstm_modal-btn" onclick="closeModal('orderModal')">Close</button>
			</div>
		</div>
	</div>

	<!-- Custom Delete Confirmation Modal -->
	<div class="custom-modal-overlay" id="deleteModal">
		<div class="custom-modal">
			<div class="custom-modal-header">Confirm Delete</div>
			<div class="custom-modal-body">
				Are you sure you want to delete this order?
			</div>
			<div class="custom-modal-footer">
				<button class="custome_modal_btn" onclick="closeModal('deleteModal')">Cancel</button>
				<button class="custome_modal_btn h_cstm_modal-btn" id="confirmDeleteBtn">Delete</button>
			</div>
		</div>
	</div>

	<!-- Overlay for mobile -->
	<div class="overlay"></div>

	<!-- Bootstrap (only for layout, no modal usage) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sidebar-loader.js"></script>
	<script src="/js/navbar-loader.js"></script>

	<script>
		// Orders data
		const orders = [
			{ no: 1, customer: "Gail C. Anderson", id: "#583488/80", status: "Completed", total: "CAD $240.00", date: "2023-09-15", products: [{ name: "Casual Shirt", size: "M", color: "Blue", fabric: "Cotton", qty: 2 }, { name: "Formal Pants", size: "32", color: "Black", fabric: "Polyester", qty: 1 }] },
			{ no: 2, customer: "Jung S. Ayala", id: "#456754/80", status: "Pending", total: "CAD $125.00", date: "2023-09-16", products: [{ name: "Winter Jacket", size: "L", color: "Grey", fabric: "Wool", qty: 1 }] },
			{ no: 3, customer: "David A. Arnold", id: "#578246/80", status: "Completed", total: "CAD $399.00", date: "2023-09-17", products: [{ name: "Running Shoes", size: "42", color: "White", fabric: "Mesh", qty: 3 }] },
			{ no: 4, customer: "Cecile D. Gordon", id: "#348930/80", status: "Pending", total: "CAD $89.00", date: "2023-09-18", products: [{ name: "T-shirt", size: "S", color: "Red", fabric: "Cotton", qty: 1 }, { name: "Shorts", size: "M", color: "Black", fabric: "Polyester", qty: 1 }] },
			{ no: 5, customer: "William Moreno", id: "#391367/80", status: "Completed", total: "CAD $560.00", date: "2023-09-19", products: [{ name: "Hoodie", size: "XL", color: "Green", fabric: "Fleece", qty: 5 }] }
		];

		const rowsPerPage = 5;
		let currentPage = 1;
		let orderToDelete = null;

		// Render Table
		function renderTable() {
			const tableBody = document.getElementById('tableBody');
			tableBody.innerHTML = "";

			const start = (currentPage - 1) * rowsPerPage;
			const end = start + rowsPerPage;
			const paginatedOrders = orders.slice(start, end);

			paginatedOrders.forEach(order => {
				const statusBadge = `<span class="custom-badge">${order.status}</span>`;
				const tr = document.createElement('tr');
				tr.innerHTML = `
					<td>${order.no}</td>
					<td>${order.customer}</td>
					<td>${order.id}</td>
					<td>${statusBadge}</td>
					<td>${order.total}</td>
					<td>${order.date}</td>
					<td>
						<button class="btn btn-sm me-1 orderlist-table-icons" onclick="viewOrder(${order.no})"><i class="bi bi-eye"></i></button>
						<button class="btn btn-sm orderlist-table-icons" onclick="deleteOrder(${order.no})"><i class="bi bi-trash"></i></button>
					</td>`;
				tableBody.appendChild(tr);
			});

			const totalPages = Math.ceil(orders.length / rowsPerPage);
			document.getElementById("pageInfo").innerText = `${currentPage}/${totalPages}`;
			document.querySelector("nav").classList.toggle("d-none", totalPages <= 1);
		}

		// Open / Close modal
		function openModal(id) {
			document.getElementById(id).style.display = 'flex';
		}
		function closeModal(id) {
			document.getElementById(id).style.display = 'none';
		}
		// close modal with overlay
		document.getElementById("orderModal").addEventListener("click", function (e) {
			if (e.target === this) {
				closeModal("orderModal");
			}
		});

		document.getElementById("deleteModal").addEventListener("click", function (e) {
			if (e.target === this) {
				closeModal("deleteModal");
			}
		});

		// View Order
		function viewOrder(orderNo) {
			const order = orders.find(o => o.no === orderNo);
			if (order) {
				let productRows = order.products.map(p =>
					`<tr><td>${p.name}</td><td>${p.size}</td><td>${p.color}</td><td>${p.fabric}</td><td>${p.qty}</td></tr>`
				).join("");

				document.getElementById("modalContent").innerHTML = `
					<p><strong>Customer:</strong> ${order.customer}</p>
					<p><strong>Order ID:</strong> ${order.id}</p>
					<p><strong>Status:</strong> ${order.status}</p>
					<p><strong>Total:</strong> ${order.total}</p>
					<p><strong>Order Date:</strong> ${order.date}</p>
					<h6 class="mt-3">Products</h6>
					<div class="table-responsive">
						<table class="table table-bordered text-center">
							<thead class="table-light"><tr><th>Product Name</th><th>Size</th><th>Color</th><th>Fabric</th><th>Qty</th></tr></thead>
							<tbody>${productRows}</tbody>
						</table>
					</div>`;
				openModal("orderModal");
			}
		}

		// Delete Order
		function deleteOrder(orderNo) {
			orderToDelete = orderNo;
			openModal("deleteModal");
		}

		document.getElementById("confirmDeleteBtn").addEventListener("click", () => {
			if (orderToDelete !== null) {
				const index = orders.findIndex(o => o.no === orderToDelete);
				if (index !== -1) {
					orders.splice(index, 1);
					renderTable();
				}
				orderToDelete = null;
				closeModal("deleteModal");
			}
		});

		// Pagination
		document.getElementById("prevBtn").addEventListener("click", () => {
			if (currentPage > 1) { currentPage--; renderTable(); }
		});
		document.getElementById("nextBtn").addEventListener("click", () => {
			if (currentPage < Math.ceil(orders.length / rowsPerPage)) { currentPage++; renderTable(); }
		});

		// Initial Render
		renderTable();
	</script>
</body>

</html>