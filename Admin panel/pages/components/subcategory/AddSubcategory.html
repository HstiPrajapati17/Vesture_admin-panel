<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>

	<!-- Bootstrap (used by markup classes) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/Sidebar.css">
	<link rel="stylesheet" href="/css/subcategory.css">
	<link rel="stylesheet" href="/css/myprofile.css">
	<style>
/* Custom caret with spacing */
.h_dark-input-select {
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 8px 12px;
  width: 100%;

  /* caret ne hide karo (browser no default) */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;

  /* custom caret add karo */
  background-image: url("data:image/svg+xml;utf8,<svg fill='black' height='12' viewBox='0 0 24 24' width='12' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 1rem center; /* caret ne right side thi spacing */
  background-size: 22px;
  padding-right: 2rem; /* text ne caret sathe overlap thava na de */
}


	</style>
</head>

<body>

	<!-- Sidebar container -->
	<div id="sidebar-container"></div>

	<!-- Navbar container -->
	<div id="navbar-container"></div>

	<main class="main-content" id="main-content">
		<div class="h_container-app">
			<div class="h_sheet" role="main" aria-labelledby="pageTitle">
				<header class="h_sheet-header">
					<div class="h_title" id="pageTitle"><i class="bi bi-tags"></i>
						<span id="pageMode">Add Subcategory</span>
					</div>
				</header>

				<div class="h_sheet-body">
					<!-- Left: Upload + quick settings -->
					<aside class="h_col-left">
						<h6 class="mb-2">Subcategory Photo</h6>

						<label class="h_upload-area" id="uploadZone" for="subcategoryImage">
							<i class="bi bi-cloud-arrow-up-fill fs-3 d-block mb-2" style="color:var(--primary)"></i>
							<strong>Drag & drop</strong> or <u>click to browse</u>
							<div class="h_upload-hint mt-2">Maximum file size: 5MB â€¢ PNG, JPG, JPEG</div>
							<input id="subcategoryImage" type="file" accept="image/png,image/jpeg" multiple>
							<img id="singlePreview" class="h_preview" alt="Preview" style="display:none">
							<div id="previewGrid" class="h_preview-grid" aria-live="polite"></div>
						</label>

						<div style="height:1px;background:var(--soft);margin:16px 0"></div>

						<h6 class="h_section-label">Quick Settings</h6>

						<div class="form-check form-switch h_form-switch mb-2">
							<input class="form-check-input" type="checkbox" id="isVisible" checked>
							<label class="form-check-label ms-2" for="isVisible">Visible on store</label>
						</div>

						<!-- Status toggle: Active / Inactive -->
						<div class="mt-3 mb-3">
							<label class="h_field-label">Status</label>
							<div class="d-flex align-items-center gap-4">
								<label class="h_radio">
									<input type="radio" name="statusRadio" id="statusActive" value="active" checked>
									Active
								</label>
								<label class="h_radio">
									<input type="radio" name="statusRadio" id="statusInactive" value="inactive">
									Inactive
								</label>
							</div>
						</div>
					</aside>

					<!-- Right: Form -->
					<section class="h_col-right">
						<form id="subcategoryForm" class="needs-validation" novalidate>
							<div class="mb-3">
								<h6 class="h_section-label">Subcategory Information</h6>

								<label class="h_field-label" for="title">Subcategory Name</label>
								<input id="title" type="text" class="h_dark-input" placeholder="Enter Subcategory Name"
									required>
								<div class="invalid-feedback">Please enter a subcategory name.</div>
							</div>

							<!-- Parent Category as a dropdown -->
							<label class="h_field-label" for="parentCategoryInput">Category Name</label>
							<select id="parentCategoryInput" name="parentCategory" class="h_dark-input h_dark-input-select mb-3" required>
								<option value="">-- Select Category --</option>
								<option value="Men">Men</option>
								<option value="Women">Women</option>
								<option value="Kids">Kids</option>
								<option value="Accessories">Accessories</option>
							</select>
							<div class="invalid-feedback">Please select a category.</div>

							<label class="h_field-label" for="code">Subcategory Code</label>
							<input id="code" type="text" class="h_dark-input mb-3" placeholder="E.g. SUB-MEN-001"
								required>
							<div class="invalid-feedback">Please enter a unique subcategory code.</div>

							<div class="mb-3">
								<label class="h_field-label" for="description">Description</label>
								<textarea id="description" class="h_dark-textarea"
									placeholder="Subcategory description"></textarea>
							</div>

							<div class="d-flex flex-wrap justify-content-end gap-2 mt-3">
								<button type="button" class="btn h_btn-outline-primary" id="cancelBtn"
									onclick="window.location.href='SubcategoryList.html'"><i
										class="bi bi-x-circle me-1"></i>Cancel</button>
								<button type="submit" class="btn h_btn-primary" id="saveBtn"><i
										class="bi bi-check2-circle me-1"></i><span id="saveText">Add
										Subcategory</span></button>
							</div>
						</form>
					</section>
				</div>
			</div>
		</div>
	</main>

	<!-- Overlay for mobile -->
	<div class="overlay"></div>

	<!-- Bootstrap JS bundle -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sidebar-loader.js"></script>
	<script src="/js/navbar-loader.js"></script>

	<script>
		// Header mode toggle based on ?mode=edit
		(function () {
			const params = new URLSearchParams(window.location.search || '');
			const isEdit = params.get('mode') === 'edit';
			const pageModeEl = document.getElementById('pageMode');
			const saveTextEl = document.getElementById('saveText');
			if (pageModeEl) pageModeEl.textContent = isEdit ? 'Edit Subcategory' : 'Add Subcategory';
			if (saveTextEl) saveTextEl.textContent = isEdit ? 'Save Changes' : 'Add Subcategory';

			// Pre-fill form fields if in edit mode
			if (isEdit) {
				document.getElementById('title').value = params.get('name') || '';
				document.getElementById('parentCategoryInput').value = params.get('parent') || '';
				document.getElementById('code').value = params.get('id') || '';
				document.getElementById('description').value = params.get('desc') || '';
				const status = params.get('status') || 'active';
				document.getElementById('statusActive').checked = status === 'active';
				document.getElementById('statusInactive').checked = status === 'inactive';

				// Set image preview
				const imagePreview = document.getElementById('singlePreview');
				const imageUrl = params.get('image') || '';
				if (imagePreview && imageUrl) {
					imagePreview.src = imageUrl;
					imagePreview.style.display = 'block';
				}
			}
		})();

		// Upload area behavior
		(function () {
			const zone = document.getElementById('uploadZone');
			const input = document.getElementById('subcategoryImage');
			const grid = document.getElementById('previewGrid');
			const singlePreview = document.getElementById('singlePreview');

			zone.addEventListener('click', () => input.click());
			zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
			zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
			zone.addEventListener('drop', e => {
				e.preventDefault(); zone.classList.remove('dragover');
				const files = Array.from(e.dataTransfer.files || []);
				try { input.files = e.dataTransfer.files; } catch (_) { }
				renderFiles(files.length ? files : Array.from(input.files || []));
			});

			input.addEventListener('change', () => {
				renderFiles(Array.from(input.files || []));
			});

			function renderFiles(files) {
				grid.innerHTML = '';
				singlePreview.style.display = 'none';
				if (!files.length) return;
				if (files.length === 1) {
					const file = files[0];
					if (!file.type.startsWith('image/')) return;
					const url = URL.createObjectURL(file);
					singlePreview.src = url; singlePreview.style.display = 'block';
					singlePreview.onload = () => URL.revokeObjectURL(url);
				} else {
					files.forEach(f => {
						if (!f.type.startsWith('image/')) return;
						const url = URL.createObjectURL(f);
						const wrap = document.createElement('div'); wrap.className = 'h_thumb';
						const img = document.createElement('img'); img.alt = f.name; img.src = url;
						img.onload = () => URL.revokeObjectURL(url);
						wrap.appendChild(img); grid.appendChild(wrap);
					});
				}
			}
		})();

		// Validation and submit handling
		(function () {
			const form = document.getElementById('subcategoryForm');
			if (!form) return;

			form.addEventListener('submit', function (event) {
				const codeEl = document.getElementById('code');
				const parentInput = document.getElementById('parentCategoryInput');
				const titleEl = document.getElementById('title');

				if (!codeEl.value.trim()) {
					codeEl.classList.add('is-invalid');
				} else {
					codeEl.classList.remove('is-invalid');
				}

				if (parentInput && !parentInput.value.trim()) {
					parentInput.classList.add('is-invalid');
				} else if (parentInput) {
					parentInput.classList.remove('is-invalid');
				}

				if (!form.checkValidity() || !codeEl.value.trim() || (parentInput && !parentInput.value.trim())) {
					event.preventDefault(); event.stopPropagation();
					form.classList.add('was-validated');
					return;
				}

				event.preventDefault(); // demo behavior

				const status = document.querySelector('input[name="statusRadio"]:checked')?.value || 'active';
				const payload = {
					title: titleEl?.value.trim() || '',
					code: codeEl?.value.trim() || '',
					description: document.getElementById('description')?.value.trim() || '',
					visible: document.getElementById('isVisible')?.checked || false,
					status: status,
					parentCategory: parentInput?.value.trim() || ''
				};

				console.log('Subcategory payload', payload);
				alert('Subcategory saved (demo). Check console for payload.');

				form.classList.add('was-validated');
			}, false);
		})();
	</script>
</body>

</html>
