<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/Sidebar.css">
    <link rel="stylesheet" href="/css/category.css">
    <link rel="stylesheet" href="/css/subcategory.css">
</head>
<body>
    <div id="sidebar-container"></div>

    <div id="navbar-container"></div>

    <main class="main-content" id="main-content">
        <div class="container-fluid">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>Work Reports <i class="bi bi-file-earmark-bar-graph"></i></h4>
                    <a href="AddWorkReport.html" class="action-btn">+ Add Report</a>
                </div>
                <div class="table-responsive">
                    <table class="category-table table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Manufacturer</th>
                                <th>Order</th>
                                <th>Date</th>
                                <th>Progress</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this report?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn category-custome-btn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn category-custome-btn" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editReportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Work Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editReportForm">
                        <div class="mb-3">
                            <label for="editManufacturer" class="form-label">Manufacturer</label>
                            <input type="text" class="form-control" id="editManufacturer">
                        </div>
                        <div class="mb-3">
                            <label for="editOrder" class="form-label">Order</label>
                            <input type="text" class="form-control" id="editOrder">
                        </div>
                        <div class="mb-3">
                            <label for="editDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="editDate">
                        </div>
                        <div class="mb-3">
                            <label for="editProgress" class="form-label">Progress</label>
                            <textarea class="form-control" id="editProgress"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn category-custome-btn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn category-custome-btn" id="saveEditReportBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/sidebar-loader.js"></script>
    <script src="/js/navbar-loader.js"></script>
    <script>
        const reportData = [
            { id: 1, manufacturer: "Alpha Textiles", order: "PO001", date: "2025-09-02", progress: "50% stitching done" },
            { id: 2, manufacturer: "Beta Garments", order: "PO002", date: "2025-09-03", progress: "Cutting completed" },
            { id: 3, manufacturer: "Gamma Fabrics", order: "PO003", date: "2025-09-04", progress: "Dyeing in progress" },
            { id: 4, manufacturer: "Delta Weavers", order: "PO004", date: "2025-09-04", progress: "Ready for quality check" }
        ];

        const tableBody = document.getElementById("reportTableBody");
        let reportToDeleteId = null;
        let reportToEditId = null;

        function renderTable(data) {
            tableBody.innerHTML = "";
            data.forEach(report => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.manufacturer}</td>
                    <td>${report.order}</td>
                    <td>${report.date}</td>
                    <td>${report.progress}</td>
                    <td class="d-flex justify-content-center align-items-center gap-2">
                        <button class="btn category-custome-btn btn-sm" title="Edit" onclick="editReport(${report.id})"><i class="bi bi-pencil-square"></i></button>
                    </td>
                    `;
                tableBody.appendChild(tr);
            });
        }

        renderTable(reportData);

        // ===== Delete with modal =====
        function confirmDeleteReport(id) {
            reportToDeleteId = id;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }

        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            const index = reportData.findIndex(r => r.id === reportToDeleteId);
            if (index > -1) reportData.splice(index, 1);
            renderTable(reportData);
            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            deleteModal.hide();
        });

        // ===== Edit report modal =====
        function editReport(id) {
            reportToEditId = id;
            const report = reportData.find(r => r.id === id);
            if (!report) return;

            document.getElementById('editManufacturer').value = report.manufacturer;
            document.getElementById('editOrder').value = report.order;
            document.getElementById('editDate').value = report.date;
            document.getElementById('editProgress').value = report.progress;

            const editModal = new bootstrap.Modal(document.getElementById('editReportModal'));
            editModal.show();
        };

        document.getElementById('saveEditReportBtn').addEventListener('click', () => {
            const report = reportData.find(r => r.id === reportToEditId);
            if (!report) return;
            report.manufacturer = document.getElementById('editManufacturer').value;
            report.order = document.getElementById('editOrder').value;
            report.date = document.getElementById('editDate').value;
            report.progress = document.getElementById('editProgress').value;
            renderTable(reportData);

            const editModal = bootstrap.Modal.getInstance(document.getElementById('editReportModal'));
            editModal.hide();
        });
    </script>
</body>
</html>