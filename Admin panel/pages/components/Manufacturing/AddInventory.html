<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClothMan Admin — Add / Edit Inventory</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/Sidebar.css">
  <link rel="stylesheet" href="/css/subcategory.css">
  <link rel="stylesheet" href="/css/myprofile.css">
</head>

<body>
  <!-- Sidebar container -->
  <div id="sidebar-container"></div>

  <!-- Navbar container -->
  <div id="navbar-container"></div>

  <main class="main-content" id="main-content">
    <div class="h_container-app">
      <div class="h_sheet" role="main" aria-labelledby="pageTitle">

        <!-- Header -->
        <header class="h_sheet-header">
          <div class="h_title" id="pageTitle">
            <i class="bi bi-plus-circle"></i>
            <span id="pageMode">Add Inventory</span>
          </div>
        </header>

        <div class="h_sheet-body">

          <!-- Left: Quick settings -->
          <aside class="h_col-left">
            <h6 class="mb-2">Inventory Image</h6>
            <label class="h_upload-area" id="uploadZone" for="inventoryImage">
              <i class="bi bi-cloud-arrow-up-fill fs-3 d-block mb-2" style="color:var(--primary)"></i>
              <strong>Drag & drop</strong> or <u>click to browse</u>
              <div class="h_upload-hint mt-2">Maximum file size: 5MB • PNG, JPG, JPEG</div>
              <input id="inventoryImage" type="file" accept="image/png,image/jpeg" multiple>
              <img id="singlePreview" class="h_preview" alt="Preview" style="display:none">
              <div id="previewGrid" class="h_preview-grid" aria-live="polite"></div>
            </label>

            <div style="height:1px;background:var(--soft);margin:16px 0"></div>

            <h6 class="h_section-label">Quick Settings</h6>
            <div class="mt-3 mb-3">
              <label class="h_field-label">Status</label>
              <div class="d-flex align-items-center gap-4">
                <label class="h_radio text-nowrap">
                  <input type="radio" name="statusRadio" id="statusInStock" value="In Stock" checked> In Stock
                </label>
                <label class="h_radio text-nowrap">
                  <input type="radio" name="statusRadio" id="statusLow" value="Low"> Low
                </label>
                <label class="h_radio text-nowrap">
                  <input type="radio" name="statusRadio" id="statusOut" value="Out of Stock"> Out of Stock
                </label>
              </div>
            </div>
          </aside>

          <!-- Right: Inventory form -->
          <section class="h_col-right">
            <form id="inventoryForm" class="needs-validation" novalidate>
              <div class="mb-3">
                <h6 class="h_section-label">Inventory Information</h6>

                <label class="h_field-label" for="product">Product Name</label>
                <input id="product" type="text" class="h_dark-input" placeholder="Enter product name" required>
                <div class="invalid-feedback">Please enter a product name.</div>
              </div>

              <div class="mb-3">
                <label class="h_field-label" for="batchNo">Batch Number</label>
                <input id="batchNo" type="text" class="h_dark-input" placeholder="Enter batch number" required>
                <div class="invalid-feedback">Please enter a batch number.</div>
              </div>

              <div class="mb-3">
                <label class="h_field-label" for="quantity">Quantity</label>
                <input id="quantity" type="number" class="h_dark-input" placeholder="Enter quantity" required>
                <div class="invalid-feedback">Please enter a quantity.</div>
              </div>

              <div class="mb-3">
                <label class="h_field-label" for="inventoryDate">Date</label>
                <input id="inventoryDate" type="date" class="h_dark-input" required>
                <div class="invalid-feedback">Please select a date.</div>
              </div>

              <div class="d-flex flex-wrap justify-content-end gap-2 mt-3">
                <button type="button" class="btn h_btn-outline-primary" id="cancelBtn"
                  onclick="window.location.href='Inventory.html'"><i class="bi bi-x-circle me-1"></i>Cancel</button>
                <button type="submit" class="btn h_btn-primary" id="saveBtn"><i
                    class="bi bi-check2-circle me-1"></i><span id="saveText">Add Inventory</span></button>
              </div>
            </form>
          </section>

        </div>
      </div>
    </div>
  </main>

  <!-- Overlay for mobile -->
  <div class="overlay"></div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/sidebar-loader.js"></script>
  <script src="/js/navbar-loader.js"></script>

  <script>
    // Cancel button — go back
    document.getElementById('cancelBtn').addEventListener('click', () => history.back());

    // Check if editing
    window.addEventListener('DOMContentLoaded', () => {
      const editItem = localStorage.getItem('editInventory');
      if (editItem) {
        const item = JSON.parse(editItem);

        // Update page title
        document.getElementById('pageMode').textContent = 'Edit Inventory';
        document.getElementById('saveText').textContent = 'Update Inventory';

        // Fill the form
        document.getElementById('product').value = item.product;
        document.getElementById('batchNo').value = item.batch;
        document.getElementById('quantity').value = item.qty;
        document.getElementById('inventoryDate').value = item.date;

        // Set status radio
        if (item.status === 'In Stock') document.getElementById('statusInStock').checked = true;
        else if (item.status === 'Low') document.getElementById('statusLow').checked = true;
        else if (item.status === 'Out of Stock') document.getElementById('statusOut').checked = true;

        // Remove localStorage so it won't refill next time
        localStorage.removeItem('editInventory');
      }
    });

    // Form validation & submit
    (function () {
      const form = document.getElementById('inventoryForm');
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
          form.classList.add('was-validated');
          return;
        }
        event.preventDefault(); // prevent actual submit

        const status = document.querySelector('input[name="statusRadio"]:checked')?.value || 'In Stock';
        const payload = {
          product: document.getElementById('product').value.trim(),
          batchNo: document.getElementById('batchNo').value.trim(),
          quantity: document.getElementById('quantity').value,
          date: document.getElementById('inventoryDate').value,
          status: status
        };

        console.log('Inventory payload:', payload);
        alert('Inventory saved (demo). Check console for payload.');
      }, false);
    })();
  </script>
</body>

</html>
